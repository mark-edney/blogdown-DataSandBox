---
title: Benchmarking Data Tables
author: Mark Edney
date: '2022-04-12'
slug: []
categories:
  - How-to
tags:
  - R
draft: yes
description: 'A look into the claim performance of Data Tables in the R language.'
archives:
  - 2022/04
---

<script src="{{< blogdown/postref >}}index.en_files/header-attrs/header-attrs.js"></script>


<p>When I started learning R, I was heard vague tales of the use of Data tables. Really just whisperers of something to consider in the future after I’ve become more proficient. Well now is the time to learn what if anything I’ve been missing out on.</p>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Data tables are a potential replacement for the common dataframe. It seeks to perform that same role but with improved performance. I would like to see the speed comparison between data frames, data tables and tibbles. I will use the <code>microbenchmark</code> package to perform the actual benchmarking.</p>
<pre class="r"><code>library(tidyverse)
library(data.table)
library(microbenchmark)
library(farff)</code></pre>
<p>For the benchmark, I will use the ‘credit-g’ dataset which can be found on the <a href="https://www.openml.org/search?type=data&amp;status=active&amp;id=31">open ml</a> website. I’m pretty sure the last openml dataset I used was a csv file but the seem to have moved to a ARFF format. I will need to use the <code>farff</code> package to load the data.</p>
<pre class="r"><code>df &lt;- farff::readARFF(&#39;dataset_31_credit-g.arff&#39;)
dt &lt;- setDT(df)
ti &lt;- tibble(df)</code></pre>
</div>
<div id="syntax" class="section level2">
<h2>Syntax</h2>
<p>The syntax for data tables is a little be different</p>
<blockquote>
<p>DT[i,j,by]</p>
</blockquote>
<p>In this manner, a at data table can be subset by i, to calculate j when grouped with a by. For this comparison, we will look at the performance of finding the average age of the credit holders grouped by the class or credit rating.</p>
<p>Along with the special syntax, there are some common functions that add some additional simplification.</p>
<blockquote>
<p>.()</p>
</blockquote>
<p>The ‘.()’ function can be used as a place holder for ‘list()’. The list function is usefull for subseting</p>
</div>
<div id="grouped-aggregate" class="section level2">
<h2>Grouped Aggregate</h2>
<p>Aggregating data in data tables is simple by using the j and by parameters in the syntax. Again multiple functions or even multiple groupings can be passed with the ‘.()’ function</p>
<pre class="r"><code>microbenchmark(Data_Frame = df %&gt;% 
                                 group_by(class) %&gt;%
                       summarise(avg = mean(age)),
               Data_Table = dt[,.(avg = mean(age)), by = class],
               Tibble = ti %&gt;% 
                       group_by(class) %&gt;%
                       summarise(avg = mean(age)))</code></pre>
<pre><code>## Unit: microseconds
##        expr    min   lq     mean  median      uq     max neval
##  Data_Frame 5360.1 5980 6606.872 6373.80 7127.05 10534.6   100
##  Data_Table  597.1  784  996.864  905.55  979.00 11479.2   100
##      Tibble 5677.6 6128 7249.469 6851.00 7484.90 21799.0   100</code></pre>
</div>
<div id="taking-counts" class="section level2">
<h2>Taking counts</h2>
<p>Another function of interest is the ‘.N’ function. This function will return the count of rows.</p>
<pre class="r"><code>microbenchmark(Data_Frame = df %&gt;% 
                                 filter(credit_amount &gt; 5000, age &lt;35) %&gt;%
                       nrow(),
               Data_Table = dt[credit_amount &gt; 5000 &amp; age &lt; 35, .N ,],
               Tibble = ti %&gt;% 
                       filter(credit_amount &gt; 5000, age &lt;35) %&gt;%
                       nrow())</code></pre>
<pre><code>## Unit: microseconds
##        expr    min      lq      mean   median      uq     max neval
##  Data_Frame 8025.5 9021.40 10446.406 10004.10 11043.7 18655.2   100
##  Data_Table  267.6  362.25   472.932   473.15   537.8  1177.9   100
##      Tibble 8569.6 9519.00 11131.629 10323.30 11250.8 32538.2   100</code></pre>
</div>
<div id="creating-new-columns" class="section level2">
<h2>Creating new columns</h2>
<pre class="r"><code>microbenchmark(Data_Frame = df$property &lt;- paste(df$property_magnitude, df$housing),
               Data_Table = dt[,property := paste(property_magnitude, housing)],
               Tibble = ti$property &lt;- paste(ti$property_magnitude, ti$housing))</code></pre>
<pre><code>## Unit: microseconds
##        expr   min     lq    mean median     uq    max neval
##  Data_Frame 228.1 261.75 323.108 321.10 332.20 1419.4   100
##  Data_Table 471.1 489.30 599.450 558.80 654.60 1546.8   100
##      Tibble 244.7 267.60 315.145 290.45 358.35  671.7   100</code></pre>
</div>
